{"status":"success","code":200,"data":{"id":18,"title":"小程序-回退旧版本！","desc":"小程序回退旧版本！","content":"# 前言\n最近在电脑上使用一个微信小程序学习，今天突然下架了视频播放功课，以后只能在它的APP上观看课程，对于学习不方便。如果渠道完善的话其实使用没啥问题，但是它只推出了手机端，对于像我这样使用电脑看视频的非常不方便，然后研究了一下，发现小程序只是把视频播放入口给关了！毕竟不会为了不让使用小程序，然单独给App写一个api.\n其实小程序就是个前端页面，把禁止播放放到前端，对于浏览器页面相当好解决，而小程序不能调试。那只有一个解决办法，就是回到之前版本，\n把更新后的小程序，用旧版本替换，不过巧的是，有一次我研究小程序解包，把所有小程序复制了下来。\n## 操作\n电脑小程序目录：文档/WeChat Files/Applet/小程序目录\n截图上的目录只做参考，不一定是你电脑上的，那如何知道那个目录是改小程序目录呢，把文档/WeChat Files/Applet下所有目录删除，然后重新打开小程序，然后在到该目录下就可看见小程序目录，\n然后用旧包把__APP__.wxapkg替换，重新打开即可！\n![QQ截图20210127144845.png](https://p.pstatp.com/origin/fe9400028b1d59721ce4)\n## 总结\n此方法只适用有旧包，且只是前端做了限制的小程序！并且小程序没有下架！\n更新问题，就目前来看替换过后并不会更新，只有小程序版本再次更新后，才会更新，解包查看了更新逻辑，小程序更新是通过微信提供的Api检测的，我猜小程序应该有一个保存小程序版本等信息的文件，是通过这个文件的版本去检测更新，而不是通过项目本身的版本号！此为猜测！\n以下是更新逻辑！目前来看这种方法应该可行，附上[本文小程序旧包](https://share.weiyun.com/FH4732Og)\n``` js\nfunction autoUpdate(){\n    var self = this\n    // 判断小程序更新机制API兼容性\n    if (wx.canIUse('getUpdateManager')) {\n      const updateManager = wx.getUpdateManager()\n      //1. 检查小程序是否有新版本发布\n      updateManager.onCheckForUpdate(function (res) {\n        // 请求完新版本信息的回调\n        if (res.hasUpdate) {\n          //2. 小程序有新版本，则异步下载新版本，做好更新准备\n          updateManager.onUpdateReady(function () {\n            wx.showModal({\n              title: '更新提示',\n              content: '新版本已经准备好，是否重启应用？',\n              success: function (res) {\n                if (res.confirm) {\n                  //3. 新的版本已经下载好，调用 applyUpdate 应用新版本并重启\n                  updateManager.applyUpdate()\n                } \n                // 如果用户取消了，但又想让用户使用最新的小程序，可以再次弹出，让用户重新选择\n                // 不过要慎重哦，毕竟用户体验不好\n                // else if (res.cancel) {\n                //   wx.showModal({\n                //     title: '温馨提示~',\n                //     content: '本次更新是在旧版本的基础上做出了巨大优化，还请使用新版本',\n                //     success: function (res) {\n                //       self.autoUpdate()\n                //     }\n                //   })\n                // }\n              }\n            })\n          })\n          updateManager.onUpdateFailed(function () {\n            // 新的版本下载失败，可以给用户一些假象，重新下载小程序\n            wx.showModal({\n              title: '已经有新版本了哟~',\n              content: '新版本已经上线啦~，请您删除当前小程序，重新搜索打开哟~'\n            })\n          })\n        }\n      })\n    } else {\n      // 如果希望用户在最新版本的客户端上体验您的小程序，可以这样子提示\n      wx.showModal({\n        title: '提示',\n        content: '当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。'\n      })\n    }\n  }\n```","img":"https://p.pstatp.com/origin/138ad0001a0da331da240","classty":"前端","channels":null,"name":"云墨白","click":1,"like":1,"is_show":1,"head_show":1,"share_show":1,"copyright_show":1,"message_show":1,"deleted_at":1,"created_at":"2021-01-24T13:24:07.000000Z","updated_at":"2021-04-16T12:59:51.000000Z","label":["Js"],"view_count":1,"prevArticle":[{"id":17,"title":"Vue 3博客重构完成啦！接下来C语言和高数啦！加油啦！"}],"nextrAticle":[{"id":19,"title":"C语言-学习总结"}]}}